<!DOCTYPE html>
<html lang="ar">
<head>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>

  <meta charset="UTF-8">
  <title>نظام تسجيل المتدربين</title>
  <style>



    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      background-color: #f0f0f0;
      padding: 20px;
    }
    
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    .container {
      max-width: 1100px;
      margin: auto;
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #resultScreen, #traineesTable {
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
      text-align: right;
    }
    th {
      background-color: #eee;
    }
  </style>
</head>
<body>
  <div class="container">
   <style>
  h2 {
    text-align: center;
    font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
    margin: 5px 0;
    color: #004080;
  }

  h2:nth-child(4) {
    font-size: 1.8em;      /* أكبر حجم للعنوان الرابع */
    font-weight: bold;
    margin-top: 5px;
    color: #007acc;
  }
  
</style>



<div style="
  position: relative;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin-top: 10px;
  margin-bottom: 30px;
">

  <!-- عبارة التصميم في أقصى اليسار -->
  <div style="
    position: absolute;
    top: 10;
    left: 25px;
    font-size: 14px;
    font-weight: 800;
    background: linear-gradient(90deg, #ff00cc, #3333ff, #ff0000);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    user-select: none;
  ">

  
    🎨     Designed by Ahmed Amer

   
  <!-- الصورة الدائرية في أعلى اليسار -->
  <img src="logo.jpg" alt="الشعار" style="
    top: 80;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
  ">


  </div>

  <!-- العناوين الرئيسية -->
  <h2>وزارة الموارد المائية والرى</h2>
  <h2>الهيئة المصرية العامة لمشروعات الصرف</h2>
  <h2>مركز تدريب الصرف بطنطا</h2>
  <h2>نموذج إدارة قاعدة بيانات المتدربين</h2>
  <h2>🔹 Trainees Database Management Form </h2>
</div>

<button id="toggleFormBtn" onclick="toggleForm()">📋 عرض / إخفاء نموذج التسجيل</button>


<style>
  h2:last-of-type {
    margin-bottom: 8px; /* تقليل المسافة أسفل العنوان الأخير */
  }

  #toggleFormBtn {
    margin-top: -20px; /* تقليل المسافة العلوية للزر */
    font-size: 20px;
    font-weight: bold;
    padding: 14px 28px;
    background-color: #004085;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    transition: background-color 0.3s ease;
  }

  #toggleFormBtn:hover {
    background-color: #002752;
  }
</style>



<div id="passwordModal" style="
  display: none;
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.6);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  /* لا تضف display:flex هنا */
">

  <div style="
    background: #ffffff;
    padding: 30px 40px;
    border-radius: 14px;
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25);
    text-align: center;
    width: 360px;
    max-width: 90%;
  ">
    <h3 style="
      margin-bottom: 22px;
      font-weight: 700;
      font-size: 24px;
      color: #222222;
      letter-spacing: 0.03em;
    ">
      Password Confirmation
    </h3>
    <input
      type="password"
      id="passwordInput"
      placeholder="Enter your password"
      style="
        width: 100%;
        padding: 14px 16px;
        font-size: 16px;
        border: 1.8px solid #ddd;
        border-radius: 10px;
        box-sizing: border-box;
        transition: border-color 0.3s ease;
        outline-offset: 2px;
      "
      onfocus="this.style.borderColor='#4a90e2'"
      onblur="this.style.borderColor='#ddd'"
    />
    <div style="margin-top: 28px; display: flex; justify-content: center; gap: 16px;">
      <button
        onclick="confirmPassword()"
        style="
          flex: 1;
          padding: 14px 0;
          font-size: 16px;
          font-weight: 600;
          background-color: #2979ff;
          color: white;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          box-shadow: 0 6px 14px rgba(41, 121, 255, 0.45);
          transition: background-color 0.3s ease, box-shadow 0.3s ease;
        "
        onmouseover="this.style.backgroundColor='#1565c0'; this.style.boxShadow='0 8px 20px rgba(21, 101, 192, 0.6)'"
        onmouseout="this.style.backgroundColor='#2979ff'; this.style.boxShadow='0 6px 14px rgba(41, 121, 255, 0.45)'"
      >
        Confirm
      </button>
      <button
        onclick="closePasswordModal()"
        style="
          flex: 1;
          padding: 14px 0;
          font-size: 16px;
          font-weight: 600;
          background-color: #f0f0f0;
          color: #555555;
          border: none;
          border-radius: 10px;
          cursor: pointer;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
          transition: background-color 0.3s ease;
        "
        onmouseover="this.style.backgroundColor='#d6d6d6'"
        onmouseout="this.style.backgroundColor='#f0f0f0'"
      >
        Cancel
      </button>
    </div>
  </div>
</div>


<style>
  .db-button {
    font-size: 18px;     /* حجم الخط فقط */
    font-weight: bold;   /* تخانة الخط */
    background-color: #b3cffc;
    color: #003366;
    border: 1px solid #000000;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    transition: 0.2s ease-in-out;
  }

  .db-button:hover {
    background-color: #cce0ff;
  }
</style>

<!-- الأزرار -->
<button class="db-button" onclick="backupIndexedDB()">🔄 Backup Database</button>
<button class="db-button" onclick="document.getElementById('restoreFile').click()">♻️ Restore Database</button>
<input type="file" id="restoreFile" style="display: none;" onchange="restoreIndexedDB(event)" accept=".json" />


<div class="btn-container">
  <button class="btn btn-submit" type="button" onclick="submitForm()">
    <svg viewBox="0 0 24 24" >
      <path d="M5 13l4 4L19 7"/>
    </svg>
    إرسال البيانات
  </button>

  

  <button class="btn btn-clear" type="button" onclick="clearIndexedDB()">
    <svg viewBox="0 0 24 24">
      <path d="M18 6L6 18M6 6l12 12"/>
    </svg>
    مسح البيانات
  </button>

  <button class="btn btn-export" onclick="exportToExcel()">
    <svg viewBox="0 0 24 24">
      <path d="M12 3v12m0 0l4-4m-4 4l-4-4M4 17h16"/>
    </svg>
    تصدير إلى Excel
  </button>

  <button class="btn btn-show" type="button" onclick="toggleAllTrainees()">
  <svg viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="3"/>
    <path d="M2 12a10 10 0 0 1 20 0 10 10 0 0 1-20 0z"/>
  </svg>
  عرض / إخفاء قاعدة البيانات
</button>


<div style="text-align:center; margin: 15px 0;">
  <input 
    type="text" 
    id="searchInput" 
    placeholder="ابحث بالاسم، الدورة، التاريخ، ..." 
    style="
      width: 320px; 
      padding: 10px 15px; 
      font-size: 16px; 
      border: 1.5px solid #007BFF; 
      border-radius: 5px 0 0 5px; 
      outline: none;
      transition: border-color 0.3s ease;
    "
    onfocus="this.style.borderColor='#0056b3'"
    onblur="this.style.borderColor='#007BFF'"
  >
  <button 
    onclick="searchTrainees()" 
    style="
      padding: 11px 20px; 
      font-size: 16px; 
      background-color: #007BFF; 
      color: white; 
      border: none; 
      border-radius: 0 5px 5px 0; 
      cursor: pointer;
      box-shadow: 0 3px 6px rgba(0,0,0,0.16);
      transition: background-color 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
    "
    onmouseover="this.style.backgroundColor='#0056b3'"
    onmouseout="this.style.backgroundColor='#007BFF'"
  >
    🔍 بحث
  </button>

  </div>



<form id="registrationForm" style="display: none;">
  <!-- باقي العناصر كما هي -->
      <label>الاسم:</label>
      <input type="text" id="name" required>
      <label>رقم الهاتف:</label>
      <input type="tel" id="phone" required>
      <label>الإدارة</label>
      <input type="email" id="email" required>
      <label>المؤهل:</label>
      <input type="text" id="qualification">
      <label>الوظيفة:</label>
      <input type="text" id="job">
      <label>اسم الدورة:</label>
      <input type="text" id="course">
      <label>مدة الدورة:</label>
      <input type="text" id="duration">
      <label>الاقامة:</label>
      <select id="type">
        <option value="مقيم">مقيم</option>
        <option value="غير مقيم">غير مقيم</option>
      </select>
      <div class="buttons">
        <style>


#registrationForm {
      font-size: 20px;
      font-weight: bold;
      direction: rtl;
    }

    #registrationForm label {
      display: block;
      margin-top: 10px;
    }

    #registrationForm input,
    #registrationForm select {
      font-size: 18px;
      font-weight: bold;
      padding: 8px;
      width: 100%;
      margin-bottom: 10px;
      box-sizing: border-box;
    }



  .btn-container {
    display: flex;
    justify-content: center; /* مركز الأزرار أفقياً */
    gap: 16px;
    margin-top: 20px;
    flex-wrap: wrap; /* لو الشاشة ضيقة تتكسر الأسطر */
  }

  .btn {
    font-size: 25px;
    padding: 12px 16px;
    border: 1px solid #555;
    border-radius: 6px;
    color: #222;
    background-color: #f8f9fa;
    cursor: pointer;
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    width: 130px;
    box-shadow: none;
    font-weight: 600;
    transition: background-color 0.3s ease, color 0.3s ease;
    user-select: none;
  }



  .btn:hover {
    background-color: #e2e6ea;
    color: #000;
  }
  .btn:active {
    background-color: #ced4da;
  }

  /* ألوان رسمية */
  .btn-submit {
    border-color: #1c3d5a;
    color: #1c3d5a;
    background-color: #dbe9f4;
  }
  .btn-submit:hover {
    background-color: #c4dbf2;
  }

  .btn-add {
    border-color: #375a7f;
    color: #375a7f;
    background-color: #d3e0eb;
  }
  .btn-add:hover {
    background-color: #bbd1e4;
  }

  .btn-clear {
    border-color: #8b1c1c;
    color: #8b1c1c;
    background-color: #f2dede;
  }
  .btn-clear:hover {
    background-color: #e4baba;
  }

  .btn-export {
    border-color: #3a5f7d;
    color: #3a5f7d;
    background-color: #d1dde6;
  }
  .btn-export:hover {
    background-color: #b9c9db;
  }

  .btn-show {
    border-color: #565656;
    color: #565656;
    background-color: #e9e9e9;
  }
  .btn-show:hover {
    background-color: #d6d6d6;
  }

  .btn svg {
    width: 28px;
    height: 28px;
    fill: currentColor;
  }
</style>





</div>


      </div>
    </form>

    <style>
  #resultScreen {
    font-size: 18px;       /* تكبير الخط داخل القسم بالكامل */
    font-weight: bold;     /* جعل الخط ثقيل */
    direction: rtl;        /* لتناسق النص العربي */
    font-family: "Arial", sans-serif;
    margin-top: 20px;
  }

  #resultScreen h3 {
    font-size: 20px;
    margin-bottom: 15px;
    color: #2c3e50;
  }

  #resultScreen table {
    width: 100%;
    border-collapse: collapse;
  }

  #resultScreen th,
  #resultScreen td {
    padding: 12px 16px;
    border: 1px solid #ccc;
    text-align: right;
    font-size: 22px;
  }

  #resultScreen th {
    background-color: #f4f6f8;
    color: #333;
  }
</style>

<div id="resultScreen">
  <h3>تم تسجيل البيانات بنجاح:</h3>
  <table>
    <tr><th>الاسم</th><td id="resName"></td></tr>
    <tr><th>رقم الهاتف</th><td id="resPhone"></td></tr>
    <tr><th>الإدارة </th><td id="resEmail"></td></tr>
    <tr><th>المؤهل</th><td id="resQualification"></td></tr>
    <tr><th>الوظيفة</th><td id="resJob"></td></tr>
    <tr><th>اسم الدورة</th><td id="resCourse"></td></tr>
    <tr><th>مدة الدورة</th><td id="resDuration"></td></tr>
    <tr><th>الاقامة</th><td id="resType"></td></tr>
    <tr><th>تاريخ ووقت التسجيل</th><td id="resDatetime"></td></tr>
  </table>
</div>



   <style>
  .buttons {
    display: flex;
    gap: 16px; /* المسافة بين الأزرار */
    justify-content: center;
    margin-top: 20px;
  }

  .buttons button {
    font-size: 18px;       /* تكبير حجم الخط */
    font-weight: bold;     /* جعل الخط ثقيل */
    padding: 12px 20px;
    border: 1px solid #555;
    border-radius: 6px;
    background-color: #f8f9fa;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .buttons button:hover {
    background-color: #e2e6ea;
  }
</style>


<div class="buttons" id="actionButtons" style="display: none;">
  <button onclick="printResult()">🖨️ طباعة</button>
  <button onclick="addNewTrainee()">🧑‍🎓 إضافة متدرب جديد</button>
</div>

    </div>

   

<style>
 #traineesTable {
  background-color: rgb(255, 255, 249); /* خلفية بلون فاتح */
  padding: 15px;                       /* مسافة داخلية */
  border-radius: 15px;                 /* حواف مدورة */
  border: 5px dotted #444;             /* الإطار المنقط */
}

  /* تنسيق الجدول داخل الديف عشان يطلع مرتب */
  #traineesTable table {
    width: 100%;
    border-collapse: collapse;
    font-size: 18px;         /* حجم الخط الكبير */
    font-weight: bold;       /* يجعل الخط ثقيل */
  }

  #traineesTable th, #traineesTable td {
    border: 2px solid #ccc;
    padding: 10px;
    text-align: center;
  }

  #traineesTable th {
    background-color: #e0d8c3; /* لون مغاير شوي مناسب مع البيج */
  }

 #traineesTable h3 {
    text-align: center;      /* يوسّط العنوان */
    font-weight: bold;       /* يجعل الخط ثقيل */
    text-decoration: underline; /* يضيف خط تحت العنوان */
    margin-bottom: 15px;     /* مساحة تحت العنوان */
    font-size: 28px;         /* حجم الخط الكبير */
  }

</style>



<div id="traineesTable">
  <h3>قائمة المتدربين المسجلين:</h3>
  <table id="allTrainees">
    <thead>
      <tr>
        <th>الاسم</th><th>الهاتف</th><th>الإدارة</th><th>المؤهل</th><th>الوظيفة</th>
        <th>الدورة</th><th>المدة</th><th>الاقامة</th>
        <th>تاريخ ووقت التسجيل</th>
        <th>إجراء</th> <!-- زر الحذف -->
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>



  <script>
  let db;

  function openDB() {
    const request = indexedDB.open("TraineeDB", 1);

    request.onupgradeneeded = function (e) {
      db = e.target.result;
      if (!db.objectStoreNames.contains("trainees")) {
        db.createObjectStore("trainees", { keyPath: "id", autoIncrement: true });
      }
    };

    request.onsuccess = function (e) {
      db = e.target.result;
      loadLatestData();
    };

    request.onerror = function () {
      alert("فشل في فتح قاعدة البيانات");
    };
  }

  function submitForm() {
    const now = new Date();
    const datetime = now.toLocaleString('ar-EG', {
      year: 'numeric',
      month: 'long',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit'
    });

    const data = {
      name: document.getElementById("name").value,
      phone: document.getElementById("phone").value,
      email: document.getElementById("email").value,
      qualification: document.getElementById("qualification").value,
      job: document.getElementById("job").value,
      course: document.getElementById("course").value,
      duration: document.getElementById("duration").value,
      type: document.getElementById("type").value,
      datetime: datetime
    };

    document.getElementById("actionButtons").style.display = "flex";


    const tx = db.transaction("trainees", "readwrite");
    const store = tx.objectStore("trainees");
    const req = store.add(data);

    req.onsuccess = () => showData(data);
    req.onerror = () => alert("خطأ أثناء الحفظ");
  }

  function showData(data) {
    document.getElementById("resName").innerText = data.name;
    document.getElementById("resPhone").innerText = data.phone;
    document.getElementById("resEmail").innerText = data.email;
    document.getElementById("resQualification").innerText = data.qualification;
    document.getElementById("resJob").innerText = data.job;
    document.getElementById("resCourse").innerText = data.course;
    document.getElementById("resDuration").innerText = data.duration;
    document.getElementById("resType").innerText = data.type;
    document.getElementById("resDatetime").innerText = data.datetime || '';
    document.getElementById("registrationForm").style.display = "none";
    document.getElementById("resultScreen").style.display = "block";
  }

  function loadLatestData() {
    const tx = db.transaction("trainees", "readonly");
    const store = tx.objectStore("trainees");
    const req = store.openCursor(null, 'prev');

    req.onsuccess = e => {
      const cursor = e.target.result;
      if (cursor) {
        const d = cursor.value;
        document.getElementById("name").value = d.name;
        document.getElementById("phone").value = d.phone;
        document.getElementById("email").value = d.email;
        document.getElementById("qualification").value = d.qualification;
        document.getElementById("job").value = d.job;
        document.getElementById("course").value = d.course;
        document.getElementById("duration").value = d.duration;
        document.getElementById("type").value = d.type;
      }
    }
  }

  function exportToExcel() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  // أضفت رموز (icons) بسيطة بجانب العناوين
  const headers = [
    "👤 الاسم",
    "📞 الهاتف",
    "📧 الإدارة",
    "🎓 المؤهل",
    "💼 الوظيفة",
    "📚 الدورة",
    "⏳ المدة",
    "⚧ الاقامة",
    "📅 تاريخ ووقت التسجيل"
  ];
  const rows = [headers];
  const allData = [];

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      const d = cursor.value;
      allData.push([
        d.name,
        d.phone,
        d.email,
        d.qualification,
        d.job,
        d.course,
        d.duration,
        d.type,
        d.datetime || ""
      ]);
      cursor.continue();
    } else {
      const data = [...rows, ...allData];

      const ws = XLSX.utils.aoa_to_sheet(data);

      // إعدادات الخط وحجمه (16) مع تنسيقات الجدول
      const headerStyle = {
        font: { bold: true, sz: 16, color: { rgb: "FFFFFF" } },
        fill: { fgColor: { rgb: "4F81BD" } },
        alignment: { horizontal: "center", vertical: "center" },
        border: {
          top: { style: "thin", color: { auto: 1 } },
          bottom: { style: "thin", color: { auto: 1 } },
          left: { style: "thin", color: { auto: 1 } },
          right: { style: "thin", color: { auto: 1 } }
        }
      };

      const dataStyle = {
        font: { sz: 16 },
        alignment: { vertical: "center", wrapText: true },
        border: {
          top: { style: "thin", color: { auto: 1 } },
          bottom: { style: "thin", color: { auto: 1 } },
          left: { style: "thin", color: { auto: 1 } },
          right: { style: "thin", color: { auto: 1 } }
        }
      };

      const range = XLSX.utils.decode_range(ws["!ref"]);
      for (let R = range.s.r; R <= range.e.r; ++R) {
        for (let C = range.s.c; C <= range.e.c; ++C) {
          const cell_address = { c: C, r: R };
          const cell_ref = XLSX.utils.encode_cell(cell_address);
          if (!ws[cell_ref]) continue;
          ws[cell_ref].s = (R === 0) ? headerStyle : dataStyle;
        }
      }

      // ضبط عرض الأعمدة تلقائياً حسب المحتوى مع حد أدنى 12 وحد أقصى 40
      const colWidths = data[0].map((col, i) => {
        let maxLen = col.length;
        allData.forEach(row => {
          if (row[i] && row[i].length > maxLen) {
            maxLen = row[i].length;
          }
        });
        return { wch: Math.min(Math.max(maxLen + 4, 12), 40) };
      });
      ws['!cols'] = colWidths;

      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "المتدربين");

      XLSX.writeFile(wb, "trainees.xlsx");
    }
  };

  store.openCursor().onerror = function(e) {
    alert("حدث خطأ أثناء تحميل البيانات للتصدير.");
  };
}


  function clearIndexedDB() {
  // فتح نافذة كلمة المرور
  document.getElementById("passwordModal").style.display = "flex";
}

function confirmPassword() {
  const input = document.getElementById("passwordInput").value;
  if (input === "1611151amer") {
    const tx = db.transaction("trainees", "readwrite");
    tx.objectStore("trainees").clear().onsuccess = () => {
      alert("تم مسح البيانات.");
      location.reload();
    };
  } else {
    alert("كلمة المرور غير صحيحة.");
  }
  closePasswordModal();
}

function closePasswordModal() {
  document.getElementById("passwordModal").style.display = "none";
  document.getElementById("passwordInput").value = "";
}


  function toggleAllTrainees() {
  const traineesTable = document.getElementById("traineesTable");
  const isHidden = traineesTable.style.display === "none" || traineesTable.style.display === "";

  if (isHidden) {
    // عرض الجدول وتحديث البيانات
    const tbody = document.querySelector("#allTrainees tbody");
    tbody.innerHTML = "";
    const tx = db.transaction("trainees", "readonly");
    tx.objectStore("trainees").openCursor(null, 'prev').onsuccess = e => {
      const cursor = e.target.result;
      if (cursor) {
        const d = cursor.value;
        const row = `<tr>
          <td>${d.name}</td><td>${d.phone}</td><td>${d.email}</td>
          <td>${d.qualification}</td><td>${d.job}</td><td>${d.course}</td>
          <td>${d.duration}</td><td>${d.type}</td><td>${d.datetime || ''}</td>
          <td><button onclick="deleteRecord(${cursor.key})">🗑 حذف</button></td>
        </tr>`;
        tbody.innerHTML += row;
        cursor.continue();
      } else {
        traineesTable.style.display = 'block';
      }
    };
  } else {
    // إخفاء الجدول
    traineesTable.style.display = 'none';
  }
}


function deleteRecord(id) {
  if (confirm("هل أنت متأكد أنك تريد حذف هذا السجل؟")) {
    const tx = db.transaction("trainees", "readwrite");
    const store = tx.objectStore("trainees");
    store.delete(id).onsuccess = () => {
      alert("تم حذف السجل.");
      toggleAllTrainees();
     toggleAllTrainees();

    };
  }
}


function addNewTrainee() {
  document.getElementById("registrationForm").style.display = "block";
  document.getElementById("resultScreen").style.display = "none";
  document.getElementById("traineesTable").style.display = "none";
  document.getElementById("registrationForm").reset();
  document.getElementById("actionButtons").style.display = "none";
}


function searchTrainees() {
  const query = document.getElementById('searchInput').value.trim().toLowerCase();
  if (!query) {
    alert("الرجاء إدخال كلمة للبحث");
    return;
  }

  const tbody = document.querySelector("#allTrainees tbody");
  tbody.innerHTML = "";

  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      const d = cursor.value;

      // دمج كل القيم في نص واحد لمقارنة شاملة
      const combined = (
        d.name + " " +
        d.phone + " " +
        d.email + " " +
        d.qualification + " " +
        d.job + " " +
        d.course + " " +
        d.duration + " " +
        d.type + " " +
        (d.datetime || "")
      ).toLowerCase();

      if (combined.includes(query)) {
        const row = `<tr>
          <td>${d.name}</td><td>${d.phone}</td><td>${d.email}</td>
          <td>${d.qualification}</td><td>${d.job}</td><td>${d.course}</td>
          <td>${d.duration}</td><td>${d.type}</td><td>${d.datetime || ''}</td>
          <td><button onclick="deleteRecord(${cursor.key})">🗑 حذف</button></td>
        </tr>`;
        tbody.innerHTML += row;
      }

      cursor.continue();
    } else {
      if (!tbody.innerHTML) {
        tbody.innerHTML = `<tr><td colspan="10" style="text-align:center;">لا توجد نتائج مطابقة</td></tr>`;
      }
      document.getElementById("traineesTable").style.display = 'block';
    }
  };
}



function printResult() {
  const printContents = document.getElementById("resultScreen").innerHTML;
  const originalContents = document.body.innerHTML;

  document.body.innerHTML = printContents;
  window.print();
  document.body.innerHTML = originalContents;
  location.reload(); // يعيد تحميل الصفحة بعد الطباعة
}




function toggleForm() {
    var form = document.getElementById("registrationForm");
    if (form.style.display === "none" || form.style.display === "") {
      form.style.display = "block";
    } else {
      form.style.display = "none";
    }
  }


  function backupIndexedDB() {
  const tx = db.transaction("trainees", "readonly");
  const store = tx.objectStore("trainees");
  const allData = [];

  store.openCursor().onsuccess = function (e) {
    const cursor = e.target.result;
    if (cursor) {
      allData.push(cursor.value);
      cursor.continue();
    } else {
      const json = JSON.stringify(allData, null, 2);
      const blob = new Blob([json], { type: "application/json" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "trainees_backup.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  };
}

function restoreIndexedDB(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    try {
      const data = JSON.parse(e.target.result);
      const tx = db.transaction("trainees", "readwrite");
      const store = tx.objectStore("trainees");

      data.forEach(item => {
        store.put(item);
      });

      tx.oncomplete = () => {
        alert("Database restored successfully.");
        location.reload();
      };
    } catch (err) {
      alert("Error restoring data. Make sure it's a valid JSON backup.");
      console.error(err);
    }
  };
  reader.readAsText(file);
}


  window.onload = openDB;
</script>
</body>
</html>
